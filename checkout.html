<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Compra - Karaok√™ Multiplayer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .progress {
            display: flex;
            justify-content: center;
            gap: 50px;
            color: white;
            margin: 30px 0;
        }
        .progress-step {
            text-align: center;
            opacity: 0.7;
        }
        .progress-step.active {
            opacity: 1;
            font-weight: bold;
        }
        .progress-step.active .step-number {
            background: #4CAF50;
        }
        .step-number {
            background: rgba(255,255,255,0.2);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 5px;
        }
        
        /* ===== SELETOR DE PLANOS ===== */
        .plan-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .plan-option {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .plan-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .plan-option.selected {
            border-color: #667eea;
            background: #f0f3ff;
        }
        
        .plan-option.recommended {
            position: relative;
            border-color: #ffd700;
        }
        
        .plan-option.recommended::after {
            content: "‚≠ê RECOMENDADO";
            position: absolute;
            top: -10px;
            right: 10px;
            background: #ffd700;
            color: #333;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: bold;
        }
        
        .plan-option-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .plan-option-price {
            font-size: 1.5rem;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .plan-option-price small {
            font-size: 0.8rem;
            color: #999;
            font-weight: normal;
        }
        
        .plan-option-save {
            background: #4CAF50;
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
            margin-top: 5px;
        }
        
        .plan-option-period {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        .checkout-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .checkout-content {
                grid-template-columns: 1fr;
            }
            .plan-selector {
                grid-template-columns: 1fr;
            }
        }
        
        .order-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .order-summary h2 {
            margin-bottom: 20px;
            color: #333;
        }
        .plan-details {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .plan-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }
        .plan-price {
            font-size: 2em;
            color: #667eea;
            margin: 10px 0;
        }
        .plan-price small {
            font-size: 0.5em;
            color: #666;
        }
        .plan-features {
            list-style: none;
            padding: 0;
        }
        .plan-features li {
            padding: 5px 0;
            color: #555;
        }
        .plan-features li:before {
            content: "‚úì";
            color: #4CAF50;
            margin-right: 10px;
        }
        .price-details {
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        .price-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            color: #666;
        }
        .price-row.total {
            font-weight: bold;
            font-size: 1.2em;
            color: #333;
            border-top: 2px solid #ddd;
            padding-top: 10px;
            margin-top: 10px;
        }
        .payment-section {
            padding: 20px;
        }
        .payment-section h2 {
            margin-bottom: 20px;
            color: #333;
        }
        .bonus-banner {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        .payment-methods {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        .payment-method {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .payment-method.active {
            border-color: #667eea;
            background: #f0f3ff;
        }
        .payment-method img {
            width: 40px;
            height: 40px;
            margin-bottom: 10px;
        }
        .payment-form {
            display: none;
        }
        .payment-form.active {
            display: block;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .btn-pay {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 20px;
        }
        .btn-pay:hover {
            background: #45a049;
        }
        .pix-area {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .qrcode {
            width: 200px;
            height: 200px;
            background: white;
            margin: 20px auto;
            padding: 10px;
            border: 1px solid #ddd;
        }
        .pix-key {
            background: #eee;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 18px;
            margin: 10px 0;
        }
        .security-badge {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            color: #666;
        }
        .security-badge img {
            width: 100px;
            margin-bottom: 10px;
        }
        .security-icons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .loading.active {
            display: block;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Karaok√™ Multiplayer</h1>
            <p>Checkout Seguro ‚Ä¢ SSL Criptografado</p>
        </div>

        <div class="progress">
            <div class="progress-step active">
                <div class="step-number">1</div>
                <div>Escolha do Plano</div>
            </div>
            <div class="progress-step">
                <div class="step-number">2</div>
                <div>Pagamento</div>
            </div>
            <div class="progress-step">
                <div class="step-number">3</div>
                <div>Confirma√ß√£o</div>
            </div>
        </div>

        <!-- SELETOR DE PLANOS -->
        <div style="margin-bottom: 20px;">
            <h2 style="color: white; text-align: center; margin-bottom: 20px;">Escolha seu plano:</h2>
            <div class="plan-selector" id="planSelector"></div>
        </div>

        <div class="checkout-content">
            <!-- Coluna Esquerda: Resumo do Pedido -->
            <div class="order-summary">
                <h2>Seu Pedido</h2>
                <div class="plan-details">
                    <div class="plan-name" id="planName">Plano Trimestral</div>
                    <div class="plan-price" id="planPrice">R$ 24,90</div>
                    <div class="plan-description" id="planDescription">V√°lido por 3 meses ‚Ä¢ Economize R$ 10,80</div>
                    <ul class="plan-features" id="planFeatures">
                        <li>Salas ilimitadas</li>
                        <li>Hist√≥rico de m√∫sicas</li>
                        <li>Sistema de pontua√ß√£o</li>
                        <li>Rea√ß√µes especiais</li>
                        <li>Emojis premium</li>
                        <li>Suporte priorit√°rio</li>
                    </ul>
                </div>

                <div class="price-details">
                    <div class="price-row">
                        <span>Subtotal</span>
                        <span id="subtotal">R$ 35,70</span>
                    </div>
                    <div class="price-row">
                        <span>Desconto</span>
                        <span id="discount">-R$ 10,80</span>
                    </div>
                    <div class="price-row total">
                        <span>Total</span>
                        <span id="total">R$ 24,90</span>
                    </div>
                </div>

                <div class="bonus-banner">
                    üéÅ B√¥nus de Boas-vindas!<br>
                    Voc√™ ganhou 7 dias gr√°tis adicionais ao seu plano.<br>
                    <strong>Acesso liberado imediatamente ap√≥s a confirma√ß√£o do pagamento.</strong>
                </div>
            </div>

            <!-- Coluna Direita: Pagamento -->
            <div class="payment-section">
                <h2>Forma de pagamento</h2>
                
                <!-- Email do usu√°rio (OBRIGAT√ìRIO) -->
                <div class="form-group">
                    <label>üìß Seu melhor e-mail (para receber a senha de acesso)</label>
                    <input type="email" id="emailCliente" placeholder="exemplo@email.com" required>
                    <small style="color: #666;">Ap√≥s a confirma√ß√£o, enviaremos sua senha para este e-mail</small>
                </div>

                <!-- M√©todos de pagamento -->
                <div class="payment-methods">
                    <div class="payment-method active" onclick="selectMethod('card')">
                        <img src="https://img.icons8.com/color/48/000000/visa.png" alt="Visa">
                        <img src="https://img.icons8.com/color/48/000000/mastercard.png" alt="Mastercard">
                        <div>Cart√£o de Cr√©dito</div>
                    </div>
                    <div class="payment-method" onclick="selectMethod('pix')">
                        <img src="https://img.icons8.com/color/48/000000/pix.png" alt="PIX">
                        <div>PIX</div>
                    </div>
                </div>

                <!-- Formul√°rio Cart√£o de Cr√©dito -->
                <div id="cardForm" class="payment-form active">
                    <div class="form-group">
                        <label>N√∫mero do Cart√£o</label>
                        <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456">
                    </div>
                    <div class="form-group">
                        <label>Nome no Cart√£o</label>
                        <input type="text" id="cardName" placeholder="Como est√° no cart√£o">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Validade</label>
                            <input type="text" id="cardExpiry" placeholder="MM/AA">
                        </div>
                        <div class="form-group">
                            <label>CVV</label>
                            <input type="text" id="cardCvv" placeholder="123">
                        </div>
                    </div>
                </div>

                <!-- √Årea PIX -->
                <div id="pixForm" class="payment-form">
                    <div class="pix-area">
                        <h3>Pagamento via PIX</h3>
                        <div class="qrcode" id="qrcode">
                            <!-- QR Code ser√° gerado aqui -->
                            [QR CODE PIX]
                        </div>
                        <p>Gerado ap√≥s confirma√ß√£o</p>
                        <p>Escaneie o QR Code acima com o app do seu banco</p>
                        <div class="pix-key" id="pixKey">karaoke@mp.com</div>
                        <p>Pagamento v√°lido por 30 minutos</p>
                    </div>
                </div>

                <!-- Loading -->
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Processando pagamento...</p>
                </div>

                <!-- Mensagem de erro/sucesso -->
                <div id="alertMessage" class="alert"></div>

                <!-- Bot√£o Pagar -->
                <button class="btn-pay" onclick="processarPagamento()" id="btnPagar">
                    üí≥ Pagar R$ <span id="totalBotao">24,90</span>
                </button>

                <!-- Selos de Seguran√ßa -->
                <div class="security-badge">
                    <img src="https://img.icons8.com/color/48/000000/ssl-certificate.png" alt="SSL">
                    <p>Seus dados est√£o protegidos</p>
                    <small>Utilizamos criptografia SSL de 256-bit. N√£o armazenamos dados do seu cart√£o em nossos servidores. Todas as transa√ß√µes s√£o processadas por meio de gateways de pagamento seguros.</small>
                    <div class="security-icons">
                        <span>üîí Prote√ß√£o de Dados</span>
                        <span>‚Ü©Ô∏è Reembolso em 7 dias</span>
                        <span>üÜò Suporte 24/7</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================= CONFIGURA√á√ïES =================
        const API_URL = 'https://karaoke-api-backend3.vercel.app/api';
        
        // Plano selecionado (inicial)
        let planoSelecionado = 'trimestral';
        
        // Pre√ßos dos planos
        const plans = {
            mensal: { 
                name: 'Plano Mensal', 
                price: 19.90, 
                originalPrice: 24.90, 
                description: 'V√°lido por 1 m√™s',
                save: 'Economize R$ 5,00'
            },
            trimestral: { 
                name: 'Plano Trimestral', 
                price: 24.90, 
                originalPrice: 35.70, 
                description: 'V√°lido por 3 meses',
                save: 'Economize R$ 10,80'
            },
            semestral: { 
                name: 'Plano Semestral', 
                price: 44.90, 
                originalPrice: 71.40, 
                description: 'V√°lido por 6 meses',
                save: 'Economize R$ 26,50'
            },
            anual: { 
                name: 'Plano Anual', 
                price: 79.90, 
                originalPrice: 142.80, 
                description: 'V√°lido por 12 meses',
                save: 'Economize R$ 62,90'
            }
        };

        // Criar seletor de planos
        function criarSeletorPlanos() {
            const selector = document.getElementById('planSelector');
            let html = '';
            
            for (const [key, plan] of Object.entries(plans)) {
                const isRecommended = key === 'trimestral';
                const isSelected = key === planoSelecionado;
                
                html += `
                    <div class="plan-option ${isRecommended ? 'recommended' : ''} ${isSelected ? 'selected' : ''}" 
                         onclick="selecionarPlano('${key}')">
                        <div class="plan-option-name">${plan.name}</div>
                        <div class="plan-option-price">
                            R$ ${plan.price.toFixed(2)} 
                            <small>/m√™s</small>
                        </div>
                        <div class="plan-option-period">${plan.description}</div>
                        <div class="plan-option-save">${plan.save}</div>
                    </div>
                `;
            }
            
            selector.innerHTML = html;
        }

        // Selecionar plano
        function selecionarPlano(plano) {
            planoSelecionado = plano;
            
            // Atualizar classes
            document.querySelectorAll('.plan-option').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Adicionar classe selected no plano escolhido
            const options = document.querySelectorAll('.plan-option');
            const index = Object.keys(plans).indexOf(plano);
            if (options[index]) {
                options[index].classList.add('selected');
            }
            
            // Atualizar resumo do pedido
            atualizarResumo();
        }

        // Atualizar resumo do pedido
        function atualizarResumo() {
            const plan = plans[planoSelecionado];
            
            document.getElementById('planName').textContent = plan.name;
            document.getElementById('planPrice').textContent = `R$ ${plan.price.toFixed(2)}`;
            document.getElementById('planDescription').textContent = `${plan.description} ‚Ä¢ ${plan.save}`;
            document.getElementById('subtotal').textContent = `R$ ${plan.originalPrice.toFixed(2)}`;
            
            const desconto = plan.originalPrice - plan.price;
            document.getElementById('discount').textContent = `-R$ ${desconto.toFixed(2)}`;
            document.getElementById('total').textContent = `R$ ${plan.price.toFixed(2)}`;
            document.getElementById('totalBotao').textContent = plan.price.toFixed(2);
        }

        // M√©todo de pagamento selecionado
        let metodoAtual = 'card';

        function selectMethod(method) {
            metodoAtual = method;
            
            // Atualizar classes ativas
            document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.payment-form').forEach(el => el.classList.remove('active'));
            
            if (method === 'card') {
                document.querySelector('.payment-method').classList.add('active');
                document.getElementById('cardForm').classList.add('active');
            } else {
                document.querySelectorAll('.payment-method')[1].classList.add('active');
                document.getElementById('pixForm').classList.add('active');
                gerarPix();
            }
        }

        // Gerar PIX (simulado)
        function gerarPix() {
            document.getElementById('pixKey').textContent = `karaoke-${Date.now()}@mp.com`;
        }

        // Fun√ß√£o principal de pagamento
        async function processarPagamento() {
            const email = document.getElementById('emailCliente').value;
            
            // Validar email
            if (!email || !email.includes('@')) {
                mostrarAlerta('Por favor, digite um e-mail v√°lido para receber sua senha de acesso', 'error');
                return;
            }

            // Mostrar loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('btnPagar').disabled = true;

            try {
                // Chamar a API para criar pagamento
                const response = await fetch(`${API_URL}/criar-pagamento`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        plan: planoSelecionado,
                        email: email
                    })
                });

                const data = await response.json();

                if (data.sucesso) {
                    // Salvar informa√ß√µes no localStorage para usar depois
                    localStorage.setItem('pagamento_pendente', JSON.stringify({
                        email: email,
                        plan: planoSelecionado,
                        id: data.id
                    }));

                    if (metodoAtual === 'pix') {
                        // Para PIX, mostrar QR Code (simulado)
                        mostrarAlerta('PIX gerado! Escaneie o QR Code com seu banco', 'success');
                        document.getElementById('qrcode').innerHTML = `
                            <div style="background: white; padding: 10px;">
                                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${data.id}" style="width: 150px; height: 150px;">
                            </div>
                        `;
                        document.getElementById('loading').classList.remove('active');
                        document.getElementById('btnPagar').disabled = false;
                    } else {
                        // Para cart√£o, redirecionar para Mercado Pago
                        window.location.href = data.init_point;
                    }
                } else {
                    mostrarAlerta('Erro ao criar pagamento: ' + (data.erro || 'Tente novamente'), 'error');
                    document.getElementById('loading').classList.remove('active');
                    document.getElementById('btnPagar').disabled = false;
                }
            } catch (error) {
                console.error('Erro:', error);
                mostrarAlerta('Erro ao conectar com o servidor. Verifique sua conex√£o.', 'error');
                document.getElementById('loading').classList.remove('active');
                document.getElementById('btnPagar').disabled = false;
            }
        }

        // Mostrar alertas
        function mostrarAlerta(mensagem, tipo) {
            const alertEl = document.getElementById('alertMessage');
            alertEl.textContent = mensagem;
            alertEl.className = `alert ${tipo}`;
            
            setTimeout(() => {
                alertEl.className = 'alert';
            }, 5000);
        }

        // Verificar pagamento pendente
        function verificarPagamentoPendente() {
            const pendente = localStorage.getItem('pagamento_pendente');
            if (pendente) {
                const dados = JSON.parse(pendente);
                mostrarAlerta(`Voc√™ tem um pagamento pendente para ${dados.email}. Ap√≥s a confirma√ß√£o, a senha ser√° enviada.`, 'success');
            }
        }

        // Inicializar p√°gina
        window.onload = function() {
            criarSeletorPlanos();
            atualizarResumo();
            verificarPagamentoPendente();
            
            // Verificar se veio da URL
            const urlParams = new URLSearchParams(window.location.search);
            const planFromUrl = urlParams.get('plan');
            if (planFromUrl && plans[planFromUrl]) {
                selecionarPlano(planFromUrl);
            }
        };
    </script>
</body>
</html>
